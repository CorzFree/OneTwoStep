{"version":3,"sources":["../../../../../assets/game/script/assets/game/script/rival.js"],"names":["GLB","require","cc","Class","extends","Component","properties","heartNodes","Node","helpClip","default","url","AudioClip","jumpDownClip","start","clientEvent","on","eventType","gameOver","Game","GameManager","result","heart","hpBarSet","init","playerId","stopTime","curStopTime","playerState","PlayerState","Stand","anim","node","getComponent","Animation","jumpPos","jumpRecordId","jumpDurTime","jump","pos","callBack","Jump","Math","abs","x","play","action","moveTo","finished","callFunc","bind","myAction","sequence","runAction","jumpDown","audioEngine","setTimeout","dead","shockDead","dispatch","reborn","stopDead","gameState","GameState","Pause","self","PlayerManager","player","rival","selfScore","length","rivalScore","msg","GAME_OVER_EVENT","sendEventEx","Over","i","active","RoadManager","roadDatas","data","find","temp","ID","offsetX","row","y","offsetY","line","position","Vec2","speedUpNotify","speedUpPercent","console","log","update","dt","None","shift","isDown","p","isDeadLine","onDestroy","off"],"mappings":"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","file":"rival.js","sourceRoot":"../../../../../assets/game/script","sourcesContent":["var GLB = require(\"Glb\");\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        heartNodes: [cc.Node],\n        helpClip: {\n            default: \"\",\n            url: cc.AudioClip\n        },\n        jumpDownClip: {\n            default: \"\",\n            url: cc.AudioClip\n        }\n    },\n\n    start() {\n        clientEvent.on(clientEvent.eventType.gameOver, this.gameOver, this);\n    },\n\n    gameOver() {\n        if (Game.GameManager.result) {\n            this.heart = 0;\n            this.hpBarSet();\n        }\n    },\n\n    init: function(playerId) {\n        this.stopTime = 15;\n        this.curStopTime = 0;\n        this.playerId = playerId;\n        this.heart = 3;\n        this.playerState = PlayerState.Stand;\n        this.anim = this.node.getComponent(cc.Animation);\n        this.jumpPos = [];\n        this.jumpRecordId = 1;\n        this.jumpDurTime = 0.5;\n    },\n\n    jump: function(pos, callBack) {\n        this.playerState = PlayerState.Jump;\n        if (Math.abs(this.node.x - pos.x) < 1) {\n            this.anim.play(\"jumpForward\");\n        } else if (this.node.x - pos.x < 0) {\n            this.anim.play(\"jumpRight\");\n        } else {\n            this.anim.play(\"jumpLeft\");\n        }\n\n        var action = cc.moveTo(this.jumpDurTime, pos);\n        var finished = cc.callFunc(function() {\n            this.anim.play(\"stand\");\n            this.playerState = PlayerState.Stand;\n            if (callBack) {\n                callBack();\n            }\n        }.bind(this));\n        var myAction = cc.sequence(action, finished);\n        this.node.runAction(myAction);\n    },\n\n    jumpDown: function(pos) {\n        this.jump(pos, function() {\n            this.anim.play(\"down\");\n            cc.audioEngine.play(this.jumpDownClip, false, 1);\n            setTimeout(function() {\n                cc.audioEngine.play(this.helpClip, false, 0.5);\n            }.bind(this), 500);\n            this.dead();\n        }.bind(this));\n    },\n\n    shockDead() {\n        this.anim.play(\"shock\");\n        this.heart--;\n        this.hpBarSet();\n        if (this.heart <= 0) {\n            // 游戏结束--\n            Game.GameManager.result = true;\n            clientEvent.dispatch(clientEvent.eventType.gameOver);\n        } else {\n            setTimeout(function() {\n                this.reborn();\n            }.bind(this), 1000);\n        }\n    },\n\n    stopDead() {\n        this.heart--;\n        this.hpBarSet();\n        if (this.heart <= 0) {\n            Game.GameManager.gameState = GameState.Pause;\n            var self = Game.PlayerManager.player;\n            var rival = Game.PlayerManager.rival;\n            var selfScore = self.jumpRecordId + self.jumpPos.length;\n            var rivalScore = rival.jumpRecordId + rival.jumpPos.length;\n            var msg = {\n                action: GLB.GAME_OVER_EVENT,\n                playerId: this.playerId,\n                selfScore: selfScore,\n                rivalScore: rivalScore\n            };\n            Game.GameManager.sendEventEx(msg);\n        }\n    },\n\n    dead: function() {\n        this.heart--;\n        this.hpBarSet();\n        if (this.heart <= 0) {\n            // 游戏结束--\n            Game.GameManager.result = true;\n            clientEvent.dispatch(clientEvent.eventType.gameOver);\n        } else {\n            setTimeout(function() {\n                if (Game.GameManager.gameState !== GameState.Over) {\n                    this.reborn();\n                }\n            }.bind(this), 1000);\n        }\n    },\n\n    hpBarSet() {\n        for (var i = 0; i < this.heartNodes.length; i++) {\n            if (i < this.heart) {\n                this.heartNodes[i].active = true;\n            } else {\n                this.heartNodes[i].active = false;\n            }\n        }\n    },\n\n    reborn: function() {\n        if (Game.RoadManager.roadDatas) {\n            var data = Game.RoadManager.roadDatas.find(function(temp) {\n                return temp.ID === this.jumpRecordId + 1;\n            }.bind(this));\n\n            var x = Game.RoadManager.offsetX * (data.row - 1);\n            var y = Game.RoadManager.offsetY * (data.line - 1);\n            this.node.position = new cc.Vec2(x, y);\n            this.anim.play(\"reborn\");\n\n            this.jumpPos = [];\n            this.jumpRecordId += 2;\n        }\n    },\n\n    speedUpNotify: function() {\n        this.jumpDurTime /= Game.RoadManager.speedUpPercent;\n        this.stopTime /= Game.RoadManager.speedUpPercent;\n        if (this.stopTime < 10) {\n            this.stopTime = 10;\n        }\n        console.log(\"jumpDurTime:\" + this.jumpDurTime);\n    },\n\n    update(dt) {\n        if (Game.GameManager.gameState === GameState.Over || Game.GameManager.gameState === GameState.None) {\n            return;\n        }\n        this.curStopTime += dt;\n        if (this.curStopTime > this.stopTime) {\n            this.curStopTime = 0;\n            this.stopDead();\n        }\n        if (this.jumpPos && this.jumpPos.length > 0) {\n            this.curStopTime = 0;\n\n            console.log(\"敌人跳：\" + this.jumpRecordId);\n            var data = this.jumpPos.shift();\n            var x = Game.RoadManager.offsetX * (data.row - 1);\n            var y = Game.RoadManager.offsetY * (data.line - 1);\n            if (data.isDown) {\n                this.jumpDown(cc.p(x, y));\n            } else if (data.isDeadLine) {\n                this.shockDead();\n            } else {\n                this.jump(cc.p(x, y));\n                this.jumpRecordId++;\n            }\n        }\n    },\n\n    onDestroy() {\n        clientEvent.off(clientEvent.eventType.gameOver, this.gameOver, this);\n    }\n});\n"]}